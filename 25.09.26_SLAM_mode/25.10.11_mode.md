# 第一版模块的基础配置
**KICKPI官方的RK3568_K1B**

---

## 自行编译SDK出ubuntu22系统
[网盘链接]（https://pan.baidu.com/s/1L9WfKVmkcfLkW5lpge0mfg?pwd=3aic）

**使用PC-ubuntu22编译**
#### 依赖
```bash
sudo apt install git bc bison build-essential curl flex libsdl1.2-dev 
sudo apt install g++-multilib gcc-multilib gnupg gperf libncurses5-dev libncurses5
sudo apt install imagemagick lib32ncurses5-dev lib32readline-dev squashfs-tools 
sudo apt install lib32z1-dev liblz4-tool xsltproc libssl-dev libwxgtk3.0-gtk3-dev libgmp-dev libmpc-dev
sudo apt install libxml2 libxml2-utils schedtool lzop pngcrush rsync 
sudo apt install yasm zip zlib1g-dev  device-tree-compiler 
sudo apt install python2 python3 pip
sudo apt install python-pip gawk openjdk-8-jdk u-boot-tools patchelf expect
sudo pip install pyelftools
sudo ln -s /usr/bin/python2 /usr/bin/python

sudo apt-get install binfmt-support qemu-user-static --reinstall
```

#### 网盘下载官方rootfs放在指定文件并重命名
`ls ~/rk356x-linux/ubuntu/ubuntu-rootfs.img`



```bash
# 首次编译，设置
./build.sh lunch
# 一键编译
./build.sh
# 清除编译，然后可以重新编译
./build.sh cleanall

# 编译成功
ls ~/home/chen/rk356x-linux/rockdev/update-rk3568-kickpi-k1b*

# u盘中打开终端
sudo cp /home/chen/rk356x-linux/rockdev/update-rk3568-kickpi-k1b* ./
```

[系统烧录教程](https://github.com/tan-zhihao1/kickpi-book/blob/master/rk356x-rk3588/zh/03-%E9%95%9C%E5%83%8F%E7%83%A7%E5%BD%95/02-USB%E7%BA%BF%E7%83%A7%E5%BD%95.md)

上电后绿灯恒亮表示电源正常，蓝灯闪烁表示系统运行

## 编译ubuntu22,使用lubancat2在ubuntu22编译出的rootfs，其余步骤不变

板子的设置在以下路径

`/home/chen/rk356x-linux/device/rockchip/.chips/rk3566_rk3568/rockchip_rk3568_kickpi_k1b_ubuntu_defconfig`

Uboot与设备树相关，Kernel是系统内核同时兼容22和20，与设备树相关，Buildroot关系到系统的软件等，与设备树无关且决定ubuntu版本

**故编译buildroot得到ubuntu22版的rootfs即可，其他Uboot和Kernel不变**

官方SDK使用buildroot编译rootfs，根据原本一键编译，需将rootfs放在~/rk356x-linux/ubuntu/ubuntu-rootfs.img

**故使用lubancat2在ubuntu22编译出的rootfs代替原本网盘下载的**

将/home/chen/LubanCat_SDK/ubuntu/ubuntu-lite-rootfs.img重命名放置在~/rk356x-linux/ubuntu/ubuntu-rootfs.img

```bash
# 清除编译，然后可以重新编译
./build.sh cleanall
# 首次编译，设置
./build.sh lunch
# 一键编译
./build.sh

# 编译成功
ls ~/home/chen/rk356x-linux/rockdev/update-rk3568-kickpi-k1b*
```

[使用官方推荐的串口调试连接](https://github.com/tan-zhihao1/kickpi-book/blob/master/rk356x-rk3588/zh/02-%E5%85%A5%E9%97%A8%E5%BF%85%E8%AF%BB/02-%E5%BF%AB%E9%80%9F%E4%BD%BF%E7%94%A8.md)

---

## 设置有线网络，进行ssh连接

```bash
ip link

# 可见eth0正常
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: dummy0: <BROADCAST,NOARP> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000
    link/ether 46:cd:bc:10:f2:be brd ff:ff:ff:ff:ff:ff
3: eth0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc mq state DOWN mode DEFAULT group default qlen 1000
    link/ether d2:6e:70:05:af:ea brd ff:ff:ff:ff:ff:ff

sudo systemctl status NetworkManager
# 可见系统现在由 NetworkManager 管理网络

# 设置有线连接
sudo nano /etc/netplan/01-eth0-static.yaml

network:
  version: 2
  renderer: networkd
  ethernets:
    eth0:
      addresses:
        - 10.42.0.4/24
      gateway4: 10.42.0.1
      nameservers:
        addresses: [10.42.0.1]

# 应用
sudo netplan apply
ip addr show eth0
ip route
```

####重启到ubuntu系统，网口网线连接板子，尝试ssh连接

```bash
# 可见网口的网络上有设备
ip addr
ip route
sudo arp-scan --interface=enp45s0 --localnet
sudo ethtool enp45s0
```

```bash
# 尝试ssh连接
ssh -Y cat@10.42.0.4

# 测试上网，若失败再次重启本机和板子
ping baidu.com
```

---

## 板子一些基础设置

### 修改密码

| 用户   | 用户名 | 密码   |
| ------ | ------ | ------ |
| 普通   | cat    | temppwd |
| 管理员 | root   | root   |

修改密码为 `123`

```bash
su root
passwd root
passwd cat
```

### 本机免密登录
```bash
# 查看是否已有密匙
cat ~/.ssh/id_rsa
# 没有则生成密匙
ssh-keygen -t rsa -b 4096 -C "3329176757@qq.com"
# 设置免密登录
ssh-copy-id -i ~/.ssh/id_rsa.pub cat@10.42.0.4
```

### 基础更新，软件源和软件更新，安装ros

```bash
sudo wget http://fishros.com/install -O fishros && . fishros
sudo apt update && sudo apt upgrade
sudo apt install -y gedit git nano ros-$ROS_DISTRO-rviz2
```

### X11 转发

板子：
```bash
sudo apt install -y xauth x11-apps
sudo nano /etc/ssh/sshd_config
```

```text
X11Forwarding yes
X11DisplayOffset 10
X11UseLocalhost no
```

```bash
sudo systemctl restart ssh
```

本机：
```bash
sudo apt install -y xauth
ssh -Y cat@10.42.0.4
echo $DISPLAY
xeyes
```

### 编译功能包时运行内存2g太小，划分4g交换空间

```bash
# 确定有充足空间
df -h /
# 检查当前交换空间
free -h
# 创建4g交换空间
sudo dd if=/dev/zero of=/swapfile bs=1M count=4096
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
# 再次验证交换空间
free -h
# 永久生效
sudo cp /etc/fstab /etc/fstab.bak
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```

```bash
# 修改交换空间活跃值（可选）
cat /proc/sys/vm/swappiness
echo 'vm.swappiness=80' | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```
