# 模块搭载ubuntu22实现slam

---

## 下载功能包编译

#### 初始化工作空间

```bash
mkdir -p ~/slam_ws/src
cd ~/slam_ws
rosdepc update
rosdepc install --from-paths src --ignore-src -y
colcon build
```

#### 拉取功能包编译

```bash
cd ~
git clone -b main https://github.com/weisama/slam_lubancat2.git
sudo cp -r ~/slam_lubancat2/* ~/slam_ws/src
sudo rm -rf ~/slam_lubancat2

cd ~/slam_ws
rosdepc install --from-paths src --ignore-src -y
```

#### 安装功能包所需软件
```bash
sudo apt install -y --allow-downgrades udev ros-humble-diagnostic-updater libpcap-dev libicu70=70.1-2 libpcl-dev ros-$ROS_DISTRO-pcl-conversions ros-$ROS_DISTRO-pcl-ros
sudo apt install -y ros-$ROS_DISTRO-tf2-tools ros-$ROS_DISTRO-rqt-tf-tree libboost-all-dev
sudo apt install -y ros-humble-cartographer ros-humble-cartographer-ros
sudo apt install -y ros-$ROS_DISTRO-slam-toolbox
```

#### 编译
```bahs
cd ~/slam_ws
colcon build --packages-select lslidar_msgs
colcon build --packages-select lslidar_driver
colcon build --packages-select lidar_filter
colcon build --packages-select tf
colcon build --packages-select serial_odom_sender
colcon build --packages-select rf2o_laser_odometry
colcon build --packages-select cartographer_navigation
colcon build --packages-select karto_slam
```

### 环境变量

```bash
mousepad ~/.bashrc
source ~/slam_ws/install/setup.bash
```


---

## 基础配置

### 固定串口
```bash
ls /dev/tty*
sudo nano /etc/udev/rules.d/99-usb-serial.rules
```

```udev
SUBSYSTEM=="tty", ATTRS{idVendor}=="1a86", ATTRS{idProduct}=="55d4", SYMLINK+="usb_robot", MODE="0666"
```

```bash
sudo udevadm control --reload-rules
sudo udevadm trigger
ls -l /dev/usb_robot
```

---

## 功能包测试

```bash
# 本机ros分布式rviz可视化
rviz2 -d ~/lslidar.rviz

# 脚本启动
~/run_slam.sh


# tf变换
ros2 launch tf tf_broadcaster.launch.py
ros2 run rqt_tf_tree rqt_tf_tree

# 启动雷达
ros2 launch lslidar_driver lslidar_launch.py
ros2 topic list

# 启动雷达并固定点云数量，发布tf
ros2 launch lidar_filter lidar_filter_with_driver.launch.py
ros2 topic echo /scan --no-arr | grep "length:"

# rf2o_laser_odometry里程计
ros2 launch lidar_filter lidar_filter_with_driver.launch.py
ros2 launch rf2o_laser_odometry rf2o_laser_odometry.launch.py publish_tf:=true

# cartographer建图
ros2 launch lidar_filter lidar_filter_with_driver.launch.py
ros2 launch rf2o_laser_odometry rf2o_laser_odometry.launch.py publish_tf:=false
ros2 launch cartographer_navigation cartographer.launch.py

# SLAM_TOOLBOX建图
ros2 launch lidar_filter lidar_filter_with_driver.launch.py
ros2 launch rf2o_laser_odometry rf2o_laser_odometry.launch.py publish_tf:=true
# 异步建图快，同步占用少，建图会更新map，定位不更新map
# 异步建图
ros2 launch karto_slam online_launch.py mode:=mapping sync_async:=async
# 同步建图
ros2 launch karto_slam online_launch.py mode:=mapping sync_async:=sync
# 异步定位
ros2 launch karto_slam online_launch.py mode:=localization sync_async:=async
# 同步定位
ros2 launch karto_slam online_launch.py mode:=localization sync_async:=sync
```









