# 购买配件搭建超维空间同款S2-F290，基础配置，待更新
**飞控默认固件是PX4v1.13.3，机载电脑是迷你主机**

---

## QGC配置

```bash
EKF2_AID_MASK = 0
```
禁用GPS

```bash
CBRK_SUPPLY_CHK = 894281
```
无备用电池允许遥控解锁

```bash
SYS_CTRL_ALLOC = Enable
```
允许控制分配功能

加载超维空间科技s2-f290固件参数  
更新其中PID（MPC_xxx）参数

---

## 机载电脑下载MAVROS

修改QGC中参数

```bash
MAV_1_CONFIG：TELLEM2
MAV_1_MODE：Onboard
SER_TEL2_BAUD：961200 8N1
```

迷你主机通过串口连接TELLEM2  
TELLEM2： 5V TX RX CTS RTS GND

### 安装MAVROS

参考：https://blog.csdn.net/weixin_42037083/article/details/137102858

```bash
sudo apt-get install ros-humble-mavros ros-humble-mavros-extras
```

### 安装GeographicLib

```bash
cd ~
git clone https://github.com/weisama/GeographicLib.git
sudo cp -r GeographicLib /usr/share
rm -rf GeographicLib
```

### 查看最新的串口消息

```bash
ls /dev/ttyUSB*
sudo usermod -aG dialout $USER
sudo chmod 777 /dev/ttyUSB0
```

### 修改mavros串口设备和波特率

```bash
sudo nano /opt/ros/humble/share/mavros/launch/px4.launch
```

```xml
<arg name="fcu_url" default="/dev/ttyUSB0:921600" />
```

### 启动MAVROS

```bash
ros2 launch mavros px4.launch
ros2 launch mavros px4.launch fcu_url:=/dev/ttyUSB0:921600
```

### 查看话题列表

```bash
ros2 topic list
```

### 检查MAVROS状态

```bash
# 飞控状态
ros2 topic echo /mavros/state

# IUM数据
ros2 topic echo /mavros/imu/data
```

---

## 机载电脑mavros连接px4后，与机载电脑同wifi的本机QGC远程连接

```bash
sudo nano /opt/ros/humble/share/mavros/launch/px4.launch
```

```xml
<arg name="gcs_url" default="udp://:14509@" />
```

本机打开QGC，添加连接吊载无人机2  
type：UDP  
Port：14509  
Server：10.1.1.105:14509

**ip是机载电脑的IP**

---

## 云卓h12带屏遥控下载qgc，通过接收器连接飞控

QGC使用云卓技术人员微信提供的云卓QGC

```bash
MAV_0_CONFIG：TELLEM1
MAV_0_MODE：Normal
SER_TEL1_BAUD：57600 8N1
```

---

## 获取mid360点云，部署fastlio

**参考日志25.09.23_MID360_PC.md**

### 根据雷达安装位置修改雷达驱动设置

`gedit ~/ws_livox/src/livox_ros_driver2/config/MOD360_config.json`

```
      "extrinsic_parameter" : {
        "roll": 0.0,
        "pitch": 135.0,
        "yaw": 180.0,
        "x": -8,
        "y": 0,
        "z": -18
      }
```

```
##########建图，使用的是livox自定义格式点云，与聚类的点云格式不同
ros2 launch livox_ros_driver2 msg_MID360_launch.py
ros2 launch fast_lio mapping.launch.py

# 坐标系camera_init是启动时无人机原点，body是当前无人机坐标
```
