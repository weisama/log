# ros安装，px4安装以及gazebo仿真
ubuntu24安装px4频繁失败，成功案例见25.03.03_docker_gazebo.txt（使用docker）

鱼香ros一键安装
```bash
sudo wget http://fishros.com/install  -O fishros && . fishros
```
选择换源安装，自动自动配置清华园  
ubuntu-24.04-amd64 安装jazzy(for ubuntu24)
```bash
wget http://fishros.com/install  -O fishros && . fishros
```

报错找不到'distro'  
如果系统同时存在Python2和Python3，可能需要明确指定Python3。  
使用sudo时环境变量可能与当前用户不同，建议用sudo -H保持环境一致：
```bash
sudo -H pip3 install distro
```

---

## ros2中不包含roscore指令
检查安装指令
```bash
ros2 pkg executables turtlesim
```
输出
```
turtlesim draw_square
turtlesim mimic
turtlesim turtle_teleop_key
turtlesim turtlesim_node
```
测试小海龟
```bash
ros2 run turtlesim turtlesim_node
```
新终端
```bash
ros2 run turtlesim turtle_teleop_key
```

---

## gazebo仿真
以下在ubuntu24安装px4及gazebo仿真均失败  
- px4v1.13依赖停止维护无24版本  
- px4v1.14.0/px4v1.14.4编译频繁报错  
- px4v1.15.2 失败`make px4_sitl_default gazebo`

---
教程中px4v1.13所需的环境包很多不支持ubuntu24  
https://u0hfx9kgt5s.feishu.cn/docx/UUK8dicSgo0VFmxTSVBcGtdvnhe?from=from_copylink  
无需下载和使用proxychains4  
跳过`sudo pip install --upgrade python-dateutil`

解决E: 无法定位软件包 libncurses5
```bash
echo "deb http://security.ubuntu.com/ubuntu  focal-security main universe" > /etc/apt/sources.list.d/ubuntu-focal-sources.list
sudo apt-get update
sudo apt-get install libncurses5:i386
```

---

## 安装gazebo和px4V1.14

### 安装gazebo Harmonic (for ros2 jazzy)
https://gazebosim.org/docs/harmonic/ros_installation/
```bash
sudo apt-get install ros-${ROS_DISTRO}-ros-gz
```
验证
```bash
gz sim "https://fuel.gazebosim.org/1.0/OpenRobotics/worlds/Harmonic  World"
```

安装QGC  
https://docs.qgroundcontrol.com/master/en/qgc-user-guide/releases/daily_builds.html  
https://blog.csdn.net/weixin_55944949/article/details/130895363?ops_request_misc=%257B%2522request%255Fid%2522%253A%252221482bc28a24875bf0826ea86347e97a%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=21482bc28a24875bf0826ea86347e97a&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-2-130895363-null-null.142^v101^control&utm_term=ubuntu24%20qgc&spm=1018.2226.3001.4187

### 安装PX4V1.14
https://shiqi.blog.csdn.net/article/details/137102858
```bash
cd ~/
git clone https://github.com/PX4/PX4-Autopilot.git  -b v1.14.4
# 或
git clone https://gitee.com/voima/PX4-Autopilot.git
cd ~/PX4-Autopilot
git checkout v1.14.0
```
编辑`.gitmodules`，将github.com替换为gitee.com
```bash
gedit ~/PX4-Autopilot/.gitmodules
```
```bash
git submodule update --init --recursive
```
若出现
```
fatal: 无法在子模组路径 'src/modules/uxrce_dds_client/Micro-XRCE-DDS-Client' 中找到当前版本
```
则
```bash
rm -rf 对应路径
```

以下添加到`.bashrc`
```bash
# >>> PX4 initialize >>>
source /home/chen/PX4-Autopilot/Tools/simulation/gazebo-classic/setup_gazebo.bash ~/PX4-Autopilot ~/PX4-Autopilot/build/px4_sitl_default
export ROS_PACKAGE_PATH=$ROS_PACKAGE_PATH:/home/chen/PX4-Autopilot
export ROS_PACKAGE_PATH=$ROS_PACKAGE_PATH:/home/chen/PX4-Autopilot/Tools/simulation/gazebo-classic/sitl_gazebo-classic
# <<< PX4 initialize <<<
```
```bash
source ~/.bashrc
sudo apt install python3-pip
pip3 install kconfiglib
pip3 install --user jinja2
pip3 install --user jsonschema
```
```bash
sudo apt-get update
sudo apt-get install libgstreamer1.0-0 gstreamer1.0-plugins-base gstreamer1.0-plugins-good gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly gstreamer1.0-libav gstreamer1.0-doc gstreamer1.0-tools gstreamer1.0-x gstreamer1.0-alsa gstreamer1.0-gl gstreamer1.0-gtk3 gstreamer1.0-qt5 gstreamer1.0-pulseaudio libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev
```
```bash
bash ./Tools/setup/ubuntu.sh
```
修改`/home/chen/PX4-Autopilot/Tools/setup/requirements.txt`  
报错E: 无法定位软件包 openjdk-14-jdk
```bash
sudo apt install openjdk-17-jdk
javac -version
```
输出`javac 21.0.6`  
修改`~/PX4-Autopilot/Tools/setup/ubuntu.sh`
```
openjdk-21-jre \
openjdk-21-jdk \
```

校验安装
```bash
make px4_sitl
```
编辑`~/PX4-Autopilot/platforms/posix/src/px4/common/px4_daemon/pxh.cpp`，添加
```c
#include <stdint.h>
```

```bash
cd ~/PX4-Autopilot
make px4_sitl_default gazebo
make px4_sitl gazebo-classic
make px4_sitl gz_x500
```

起飞：
```bash
commander takeoff
```
降落：
```bash
commander land
```
