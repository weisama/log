# 实现机载电脑与px4飞控通信

### 串口实现飞控与上位机通信，gazebo仿真

> 烧录编译的 PX4V1.14.0 固件才能连接上  
> [https://blog.csdn.net/qq_44998513/article/details/133036005](https://blog.csdn.net/qq_44998513/article/details/133036005)  
> [https://shiqi.blog.csdn.net/article/details/137450308](https://shiqi.blog.csdn.net/article/details/137450308)

---

#### 修改 QGC 中参数

```
MAV_1_CONFIG：TELLEM2
MAV_1_MODE：Onboard
SER_TEL2_BAUD：961200 8N1
```

---

#### 笔记本通过串口连接 TELLEM2

| TELLEM2 引脚 | 信号 | 树莓派 4B 引脚 |
|--------------|------|----------------|
| 5V           | 5V   | 5V             |
| TX           | →    | RX             |
| RX           | ←    | TX             |
| CTS          | —    | —              |
| RTS          | —    | —              |
| GND          | GND  | GND            |

---

#### 串口通信库

```bash
sudo apt install ros-noetic-serial
```

---

#### 查看最新的串口消息

```bash
sudo dmesg | tail
ls /dev/ttyACM*
# 示例输出
# [6405.187455] cdc_acm 3-2:1.1: ttyACM1: USB ACM device
```

```bash
sudo chmod 777 /dev/ttyACM1
```

---

#### 修改 mavros 串口设备和波特率

```bash
roscd mavros
sudo gedit ./launch/px4.launch
```

将下述行改为：

```xml
<arg name="fcu_url" default="/dev/ttyACM1:921600" />
```

---

#### 启动仿真

```bash
source /home/chen/PX4-Autopilot/Tools/simulation/gazebo-classic/setup_gazebo.bash $(pwd) $(pwd)/build/px4_sitl_default
gazebo /home/chen/PX4-Autopilot/Tools/simulation/gazebo-classic/sitl_gazebo-classic/worlds/hitl_iris.world
```

---

#### 终端二：启动 mavros

```bash
roslaunch mavros px4.launch
# 或指定串口
roslaunch mavros px4.launch fcu_url:=/dev/ttyACM1:921600
```

---

#### 终端三：查看数据

GPS 数据

```bash
rostopic echo /mavros/global_position/global
```

本地坐标系，单位米

```bash
rostopic echo /mavros/local_position/pose
```

磁罗盘航向角

```bash
rostopic echo /mavros/global_position/compass_hdg
```

---

#### 串口调试工具

```bash
sudo apt-get install cutecom
sudo cutecom
```