# offboard模式下控制无人机

<https://blog.csdn.net/manbushuizhong/article/details/123744960>  
<https://docs.px4.io/v1.13/en/ros/mavros_offboard_cpp.html>

---

## offboard功能包
```bash
mkdir -p catkin_ws/src
cd catkin_ws/src
catkin_init_workspace
cd ..
catkin_make
cd src
catkin_create_pkg offboard_pkg roscpp std_msgs geometry_msgs mavros_msgs
```

编写 `offboard_node.cpp` 和 `CMakeLists.txt`

```bash
catkin_make
# 报错
# 把下面两句放在 CMakeLists.txt 最后
# add_executable(offboard_node src/offboard_node.cpp)
# target_link_libraries(offboard_node ${catkin_LIBRARIES})
```

```bash
cd /home/chen/PX4-Autopilot
# 打开仿真
make px4_sitl gazebo-classic_iris
roslaunch mavros px4.launch fcu_url:="udp://:14540@127.0.0.1:14557"

source /home/chen/catkin_ws/devel/setup.bash
rosrun offboard_pkg offboard_node
```

### GPS数据

```bash
rostopic echo /mavros/global_position/global
```

### 本地坐标系，单位米

```bash
rostopic echo /mavros/local_position/pose
```

### 磁罗盘航向角

```bash
rostopic echo /mavros/global_position/compass_hdg
```
