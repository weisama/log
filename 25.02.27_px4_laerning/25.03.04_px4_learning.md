### mavlink消息用于地面站与px4飞控的通信  
### mavros用于mavlink消息和ros节点的互相转化  

---  
## ros重要事件采用服务  

roscd等指令找不到模板，手动添加环境  

```bash
source /home/chen/PX4-Autopilot/Tools/simulation/gazebo-classic/setup_gazebo.bash /home/chen/PX4-Autopilot /home/chen/PX4-Autopilot/build/px4_sitl_default 
export ROS_PACKAGE_PATH=$ROS_PACKAGE_PATH:/home/chen/PX4-Autopilot
export ROS_PACKAGE_PATH=$ROS_PACKAGE_PATH:/home/chen/PX4-Autopilot/Tools/simulation/gazebo-classic/sitl_gazebo-classic
```  

---  
## 指令  

### 仿真  

```bash
make px4_sitl_default gazebo
make px4_sitl_default gazebo_rover
roslaunch px4 mavros_posix_sitl.launch
```  

### 节点相关  

```bash
rosnode info name
rosnode kill name
rosnade pind name
rosnade list
rosrun 
```  

### 常用的 Pixhawk 飞控硬件对应的编译命令如下：  

```bash
sudo apt-get install gcc-arm-none-eabi
```  

| 硬件平台 | 编译命令 |
| --- | --- |
| Holybro Pixhawk 6X (FMUv6X) | `make px4_fmu-v6x_default` |
| Holybro Pixhawk 6C (FMUv6C) | `make px4_fmu-v6c_default` |
| Holybro Pixhawk 6C Mini (FMUv6C) | `make px4_fmu-v6c_default` |
| Holybro Pix32 v6 (FMUv6C) | `make px4_fmu-v6c_default` |
| Holybro Pixhawk 5X (FMUv5X) | `make px4_fmu-v5x_default` |
| Pixhawk 4 (FMUv5) | `make px4_fmu-v5_default` |
| Pixhawk 4 Mini (FMUv5) | `make px4_fmu-v5_default` |
| CUAV V5+ (FMUv5) | `make px4_fmu-v5_default` |
| CUAV V5 nano (FMUv5) | `make px4_fmu-v5_default` |
| Pixracer (FMUv4) | `make px4_fmu-v4_default` |
| Pixhawk 3 Pro | `make px4_fmu-v4pro_default` |
| Pixhawk Mini | `make px4_fmu-v3_default` |
| Pixhawk 2 (Cube Black) (FMUv3) | `make px4_fmu-v3_default` |
| mRo Pixhawk (FMUv3) | `make px4_fmu-v3_default` |
| Holybro pix32 (FMUv2) | `make px4_fmu-v2_default` |
| Pixfalcon (FMUv2) | `make px4_fmu-v2_default` |
| Dropix (FMUv2) | `make px4_fmu-v2_default` |
| Pixhawk 1 (FMUv2) | `make px4_fmu-v2_default` |

### 固件烧录  

QGC，固件，插拔飞控，固件设置，高级设置，自定义固件文件，确定，选择.px4文件  

### 创建ros_tutorials_topic功能包，依赖是message_generation，std_mgs，roscpp  

```bash
catkin_create_pkg name xxx
catkin_create_pkg ros_tutorials_topic message_generation std_mgs roscpp
```  

### 创建一个仿真功能包  

参考：<https://shiqi.blog.csdn.net/article/details/137152213>  

```bash
make px4_sitl_default gazebo
my_example_app
```  

### 订阅系统话题  

参考：<https://shiqi.blog.csdn.net/article/details/137176482>  

### 创建话题  

参考：<https://shiqi.blog.csdn.net/article/details/137176073>  

---  
## QGC联合gazebo仿真  

本机启动QGC可以连接容器内gazebo  
QGC设置，常规，打开虚拟游戏手柄  

参考：<https://shiqi.blog.csdn.net/article/details/137450308>  

```bash
source /home/chen/PX4-Autopilot/Tools/simulation/gazebo-classic/setup_gazebo.bash $(pwd) $(pwd)/build/px4_sitl_default
gazebo /home/chen/PX4-Autopilot/Tools/simulation/gazebo-classic/sitl_gazebo-classic/worlds/hitl_iris.world
```  

取消勾选QGC常规自动连接到Pixhawk，会导致无法直接飞控连接QGC  

---  
## 自定义mavlink消息收发  

参考：<https://shiqi.blog.csdn.net/article/details/137843194>  

### 定义消息类型  

```bash
gedit /home/chen/PX4-Autopilot/src/modules/mavlink/mavlink/message_definitions/v1.0/common.xml
python3 /home/chen/PX4-Autopilot/src/modules/mavlink/mavlink/mavgenerate.py
```  

报错处理：  

```bash
sudo apt --fix-broken install
sudo apt update
sudo apt install python3-tk
```  

```bash
gedit /home/chen/PX4-Autopilot/src/modules/mavlink/mavlink/output/send.py
gedit /home/chen/PX4-Autopilot/src/modules/mavlink/mavlink/output/read.py
cd /home/chen/PX4-Autopilot/src/modules/mavlink/mavlink/output
python3 send.py
python3 read.py # 另打开一个终端
```  

---  
## mavros仿真  

参考：<https://zhuanlan.zhihu.com/p/580612371>  

终端一：  

```bash
roscore
```  

终端二：  

```bash
roslaunch px4 mavros_posix_sitl.launch  ### 可能需要手动添加环境
```  

终端三：  

```bash
rostopic list
```  

查看mavros发布的无人机相关话题  

---  
## 基于mavros机载控制  

参考：<https://zhuanlan.zhihu.com/p/580599454>  

---  
## QGC使用  

参考：<https://www.bilibili.com/video/BV1Uu4y197cK>  

语言设置为中文则无法规划航线
```